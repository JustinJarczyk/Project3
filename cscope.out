cscope 15 /srv/uthreads -q 0000000415 0000035777
	@interpose.c

12 
	~<¡dio.h
>

13 
	~<fú.h
>

14 
	~<”ºo.h
>

15 
	~<dlfú.h
>

16 
	~<uni¡d.h
>

17 
	~<¡ršg.h
>

18 
	~<¡d¬g.h
>

19 
	~<sigÇl.h
>

20 
	~<dœ’t.h
>

21 
	~<libš.h
>

22 
	~<sys/ty³s.h
>

23 
	~<sys/sock‘.h
>

25 
	~"uth»ad.h
"

26 
	~"uth»ad_sched.h
"

29 
	#mªgË_Çme
(
lšÇme
, 
sŞÇme
è
c_
##
	)
linname

30 
	#INTERPOSE_NEED_DLOPEN


	)

31 
c_g‘d’ts
(
fd
, 
dœ’t
 *
buf
, cÚ¡ 
size_t
 
couÁ
);

32 
c_acûss
(cÚ¡ *
fe
, 
mode
);

33 
c_chdœ
(cÚ¡ *
fe
);

34 
c_fchdœ
(
fd
);

35 
c_şo£
(
fd
);

36 
c_İ’
(cÚ¡ *
·thÇme
, 
æags
, ...);

37 
pid_t
 
c_fÜk
();

38 
off_t
 
c_l£ek
(
fd
, off_ˆ
off£t
, 
wh’û
);

39 
ssize_t
 
c_wr™e
(
fd
, cÚ¡ *
buf
, 
size_t
 
couÁ
);

40 
ssize_t
 
c_»ad
(
fd
, * 
buf
, cÚ¡ 
size_t
 
couÁ
);

41 
c_³¼Ü
(cÚ¡ *
s
);

44 #´agm¨
w—k
 
»ad
=
c_»ad


45 #´agm¨
w—k
 
wr™e
=
c_wr™e


46 #´agm¨
w—k
 
İ’
=
c_İ’


47 #´agm¨
w—k
 
şo£
=
c_şo£


48 #´agm¨
w—k
 
l£ek
=
c_l£ek


49 #´agm¨
w—k
 
chdœ
=
c_chdœ


50 #´agm¨
w—k
 
fchdœ
=
c_fchdœ


51 #´agm¨
w—k
 
acûss
=
c_acûss


52 #´agm¨
w—k
 
g‘d’ts
=
c_g‘d’ts


53 #´agm¨
w—k
 
fÜk
=
c_fÜk


54 #´agm¨
w—k
 
³¼Ü
=
c_³¼Ü


56 #´agm¨
w—k
 
__»ad
=
c_»ad


57 #´agm¨
w—k
 
__wr™e
=
c_wr™e


58 #´agm¨
w—k
 
__İ’
=
c_İ’


59 #´agm¨
w—k
 
__şo£
=
c_şo£


60 #´agm¨
w—k
 
__l£ek
=
c_l£ek


61 #´agm¨
w—k
 
__chdœ
=
c_chdœ


62 #´agm¨
w—k
 
__fchdœ
=
c_fchdœ


63 #´agm¨
w—k
 
__acûss
=
c_acûss


64 #´agm¨
w—k
 
__g‘d’ts
=
c_g‘d’ts


65 #´agm¨
w—k
 
__fÜk
=
c_fÜk


66 #´agm¨
w—k
 
__³¼Ü
=
c_³¼Ü


73 #ià
defšed
(
__SVR4
è&& defšed(
__¥¬c
)

74 
	#mªgË_Çme
(
lšÇme
, 
sŞÇme
è
_
##
	)
solname

75 #´agm¨
w—k
 
»ad
=
_»ad


76 #´agm¨
w—k
 
wr™e
=
_wr™e


77 #´agm¨
w—k
 
İ’
=
__İ’


78 #´agm¨
w—k
 
şo£
=
_şo£


79 #´agm¨
w—k
 
l£ek
=
_l£ek


80 #´agm¨
w—k
 
chdœ
=
_chdœ


81 #´agm¨
w—k
 
fchdœ
=
_fchdœ


82 #´agm¨
w—k
 
acûss
=
_acûss


83 #´agm¨
w—k
 
g‘d’ts
=
_g‘d’ts


84 #´agm¨
w—k
 
fÜk
=
__libc_fÜk


85 #´agm¨
w—k
 
³¼Ü
=
_³¼Ü


88 #ià
defšed
 
_WTHREADS


89 
	#mªgË_thr_id
 
	`wth»ad_£lf
()

	)

91 
	#mªgË_thr_id
 0

	)

95 
	$mªgË_Çme
(
³¼Ü
,…error)

96 (cÚ¡ *
s
)

99 
	`årštf
(
¡d”r
, "%s: %s", 
s
, 
	`¡»¼Ü
(
”ºo
));

100 
	}
}

103 
	$mªgË_Çme
(
acûss
,‡ccess)

104 (cÚ¡ *
fe
, 
mode
)

106 (*
	tacûss_func
)(const *, );

107 
acûss_func
 
»®_acûss
;

108 
»t
;

109 #ifdeà
INTERPOSE_NEED_DLOPEN


110 * 
libhªdË
;

113 
	`uth»ad_y›ld
();

115 #ifdeà
INTERPOSE_NEED_DLOPEN


116 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

117 
»®_acûss
 = (
acûss_func
)
	`dlsym
(
libhªdË
, "access");

119 
»®_acûss
 = (
acûss_func
)
	`dlsym
(
RTLD_NEXT
, "access");

122 
»t
 = 
	`»®_acûss
(
fe
, 
mode
);

124 #ifdeà
INTERPOSE_NEED_DLOPEN


125 
	`dlşo£
(
libhªdË
);

128  
»t
;

129 
	}
}

132 
	$mªgË_Çme
(
chdœ
, chdir)

133 (cÚ¡ *
fe
)

135 (*
	tchdœ_func
)(cÚ¡ *
	tfe
);

136 
chdœ_func
 
»®_chdœ
;

137 
»t
;

138 #ifdeà
INTERPOSE_NEED_DLOPEN


139 * 
libhªdË
;

142 
	`uth»ad_y›ld
();

144 #ifdeà
INTERPOSE_NEED_DLOPEN


145 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

146 
»®_chdœ
 = (
chdœ_func
)
	`dlsym
(
libhªdË
, "chdir");

148 
»®_chdœ
 = (
chdœ_func
)
	`dlsym
(
RTLD_NEXT
, "chdir");

151 
»t
 = 
	`»®_chdœ
(
fe
);

153 #ifdeà
INTERPOSE_NEED_DLOPEN


154 
	`dlşo£
(
libhªdË
);

157  
»t
;

158 
	}
}

161 
	$mªgË_Çme
(
fchdœ
, fchdir)

162 (
fd
)

164 (*
	tfchdœ_func
)(
	tfd
);

165 
fchdœ_func
 
»®_fchdœ
;

166 
»t
;

167 #ifdeà
INTERPOSE_NEED_DLOPEN


168 * 
libhªdË
;

171 
	`uth»ad_y›ld
();

173 #ifdeà
INTERPOSE_NEED_DLOPEN


174 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

175 
»®_fchdœ
 = (
fchdœ_func
)
	`dlsym
(
libhªdË
, "chdir");

177 
»®_fchdœ
 = (
fchdœ_func
)
	`dlsym
(
RTLD_NEXT
, "chdir");

180 
»t
 = 
	`»®_fchdœ
(
fd
);

182 #ifdeà
INTERPOSE_NEED_DLOPEN


183 
	`dlşo£
(
libhªdË
);

186  
»t
;

187 
	}
}

189 
pid_t


190 
	$mªgË_Çme
(
fÜk
, 
_libc_fÜk
)

193 
	`pid_t
 (*
	tfÜk_func
)();

194 
fÜk_func
 
»®_fÜk
;

195 
chd
;

197 #ifdeà
INTERPOSE_NEED_DLOPEN


198 * 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

199 
»®_fÜk
 = (
fÜk_func
)
	`dlsym
(
libhªdË
, "fork");

201 
»®_fÜk
 = (
fÜk_func
)
	`dlsym
(
RTLD_NEXT
, "fork");

204 ià((
chd
 = 
	`»®_fÜk
()) == 0)

213 #ifdeà
INTERPOSE_NEED_DLOPEN


214 
	`dlşo£
(
libhªdË
);

217  
chd
;

218 
	}
}

220 
ssize_t


221 
	$mªgË_Çme
(
wr™e
, write)

222 (
fd
, cÚ¡ *
buf
, 
size_t
 
couÁ
)

224 (*
	twr™e_func
)(
	tfd
, cÚ¡ *
	tbuf
, 
	tsize_t
 
	tcouÁ
);

225 
wr™e_func
 
»®_wr™e
;

226 
»t
;

227 #ifdeà
INTERPOSE_NEED_DLOPEN


228 * 
libhªdË
;

231 
	`uth»ad_y›ld
();

233 #ifdeà
INTERPOSE_NEED_DLOPEN


234 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

235 
»®_wr™e
 = (
wr™e_func
)
	`dlsym
(
libhªdË
, "write");

237 
»®_wr™e
 = (
wr™e_func
)
	`dlsym
(
RTLD_NEXT
, "write");

240 
»t
 = 
	`»®_wr™e
(
fd
,
buf
,
couÁ
);

242 #ifdeà
INTERPOSE_NEED_DLOPEN


243 
	`dlşo£
(
libhªdË
);

246  
»t
;

247 
	}
}

249 
off_t


250 
	$mªgË_Çme
(
l£ek
,†seek)

251 (
fd
, 
off_t
 
off£t
, 
wh’û
)

253 (*
	tl£ek_func
)(
	tfd
, 
	toff_t
 
	toff£t
, 
	twh’û
);

254 
l£ek_func
 
»®_l£ek
;

255 
»t
;

256 #ifdeà
INTERPOSE_NEED_DLOPEN


257 * 
libhªdË
;

260 
	`uth»ad_y›ld
();

262 #ifdeà
INTERPOSE_NEED_DLOPEN


263 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

264 
»®_l£ek
 = (
l£ek_func
)
	`dlsym
(
libhªdË
, "lseek");

266 
»®_l£ek
 = (
l£ek_func
)
	`dlsym
(
RTLD_NEXT
, "lseek");

269 
»t
 = 
	`»®_l£ek
(
fd
, 
off£t
, 
wh’û
);

271 #ifdeà
INTERPOSE_NEED_DLOPEN


272 
	`dlşo£
(
libhªdË
);

275  
»t
;

276 
	}
}

279 
	$mªgË_Çme
(
g‘d’ts
, getdents)

280 (
fd
, 
dœ’t
 *
buf
, 
size_t
 
couÁ
)

282 (*
	tg‘d’ts_func
)(
	tfd
, 
	tdœ’t
 *
	tbuf
, 
	tsize_t
 
	tcouÁ
);

283 
g‘d’ts_func
 
»®_g‘d’ts
;

284 
»t
;

285 #ifdeà
INTERPOSE_NEED_DLOPEN


286 * 
libhªdË
;

289 
	`uth»ad_y›ld
();

291 #ifdeà
INTERPOSE_NEED_DLOPEN


292 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

293 
»®_g‘d’ts
 = (
g‘d’ts_func
)
	`dlsym
(
libhªdË
, "getdents");

295 
»®_g‘d’ts
 = (
g‘d’ts_func
)
	`dlsym
(
RTLD_NEXT
, "getdents");

298 
»t
 = 
	`»®_g‘d’ts
(
fd
, 
buf
, 
couÁ
);

300 #ifdeà
INTERPOSE_NEED_DLOPEN


301 
	`dlşo£
(
libhªdË
);

304  
»t
;

305 
	}
}

308 
	$mªgË_Çme
(
şo£
, close)

309 (
fd
)

311 (*
	tşo£_func
)(
	tfd
);

312 
şo£_func
 
»®_şo£
;

313 
»t
;

314 #ifdeà
INTERPOSE_NEED_DLOPEN


315 * 
libhªdË
;

318 
	`uth»ad_y›ld
();

320 #ifdeà
INTERPOSE_NEED_DLOPEN


321 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

322 
»®_şo£
 = (
şo£_func
)
	`dlsym
(
libhªdË
, "close");

324 
»®_şo£
 = (
şo£_func
)
	`dlsym
(
RTLD_NEXT
, "close");

327 
»t
 = 
	`»®_şo£
(
fd
);

330 
	`dlşo£
(
libhªdË
);

333  
»t
;

334 
	}
}

337 
	$mªgË_Çme
(
İ’
, 
_İ’
)

338 (cÚ¡ *
·thÇme
, 
æags
, ...)

340 (*
	tİ’_func
)(cÚ¡ *
	t·thÇme
, 
	tæags
, ...);

341 
İ’_func
 
»®_İ’
;

342 
»t
;

343 #ifdeà
INTERPOSE_NEED_DLOPEN


344 * 
libhªdË
;

347 
	`uth»ad_y›ld
();

349 #ifdeà
INTERPOSE_NEED_DLOPEN


350 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

351 
»®_İ’
 = (
İ’_func
)
	`dlsym
(
libhªdË
, "open");

353 
»®_İ’
 = (
İ’_func
)
	`dlsym
(
RTLD_NEXT
, "open");

361 
»t
 = 
	`»®_İ’
(
·thÇme
, 
æags
, 0666);

363 #ifdeà
INTERPOSE_NEED_DLOPEN


364 
	`dlşo£
(
libhªdË
);

367  
»t
;

368 
	}
}

370 
ssize_t


371 
	$mªgË_Çme
(
»ad
,„ead)

372 (cÚ¡ 
fd
, * 
buf
, cÚ¡ 
size_t
 
couÁ
)

374 (*
	t»ad_func
)(cÚ¡ 
	tfd
, *
	tbuf
, cÚ¡ 
	tsize_t
 
	tcouÁ
);

375 
»ad_func
 
»®_»ad
;

376 
»t
;

377 #ifdeà
INTERPOSE_NEED_DLOPEN


378 * 
libhªdË
;

381 
	`uth»ad_y›ld
();

383 #ifdeà
INTERPOSE_NEED_DLOPEN


384 
libhªdË
 = 
	`dlİ’
("/lib/libc.so.6", 
RTLD_LAZY
);

385 
»®_»ad
 = (
»ad_func
)
	`dlsym
(
libhªdË
, "read");

387 
»®_»ad
 = (
»ad_func
)
	`dlsym
(
RTLD_NEXT
, "read");

390 
»t
 = 
	`»®_»ad
(
fd
, 
buf
, 
couÁ
);

392 #ifdeà
INTERPOSE_NEED_DLOPEN


393 
	`dlşo£
(
libhªdË
);

396  
»t
;

397 
	}
}

	@list.h

1 #iâdeà
__LIST_H__


2 
	#__LIST_H__


	)

4 
	~<¡ddef.h
>

54 
	sli¡
 {

55 
li¡
 *
	ml_Ãxt
;

56 
li¡
 *
	ml_´ev
;

57 } 
	tli¡_t
, 
	tli¡_lšk_t
;

59 
	#LIST_INITIALIZER
Ğ
li¡
 ) \

60 { (
li¡
), (li¡è}

	)

62 
	#li¡_š™
(
li¡
) \

64 (
li¡
)->
l_Ãxt
 = (li¡)->
l_´ev
 = (list); \

65 } 0)

	)

67 
	#li¡_lšk_š™
(
li¡
) \

69 (
li¡
)->
l_Ãxt
 = (li¡)->
l_´ev
 = 
NULL
; \

70 } 0)

	)

72 
	#li¡_em±y
(
li¡
) \

73 ((
li¡
)->
l_Ãxt
 =ğÖi¡))

	)

75 
	#li¡_š£¹_befÜe
(
Şd
, 
Ãw
) \

77 
li¡_lšk_t
 *
´ev
 = (
Ãw
); \

78 
li¡_lšk_t
 *
Ãxt
 = (
Şd
); \

79 
´ev
->
l_Ãxt
 = 
Ãxt
; \

80 
´ev
->
l_´ev
 = 
Ãxt
->l_prev; \

81 
Ãxt
->
l_´ev
->
l_Ãxt
 = 
´ev
; \

82 
Ãxt
->
l_´ev
 = 
´ev
; \

83 } 0)

	)

85 
	#li¡_š£¹_h—d
(
li¡
, 
lšk
) \

86 
	`li¡_š£¹_befÜe
((
li¡
)->
l_Ãxt
, 
lšk
)

	)

88 
	#li¡_š£¹_
(
li¡
, 
lšk
) \

89 
	`li¡_š£¹_befÜe
(
li¡
, 
lšk
)

	)

91 
	#li¡_»move
(
lšk
) \

93 
li¡_lšk_t
 *
Î
 = (
lšk
); \

94 
li¡_lšk_t
 *
´ev
 = 
Î
->
l_´ev
; \

95 
li¡_lšk_t
 *
Ãxt
 = 
Î
->
l_Ãxt
; \

96 
´ev
->
l_Ãxt
 = 
Ãxt
; \

97 
Ãxt
->
l_´ev
 = 
´ev
; \

98 
Î
->
l_Ãxt
 =†l->
l_´ev
 = 0; \

99 } 0)

	)

101 
	#li¡_»move_h—d
(
li¡
) \

102 
	`li¡_»move
((
li¡
)->
l_Ãxt
)

	)

104 
	#li¡_»move_
(
li¡
) \

105 
	`li¡_»move
((
li¡
)->
l_´ev
)

	)

107 
	#li¡_™em
(
lšk
, 
ty³
, 
memb”
) \

108 (
ty³
*)((*)(
lšk
è- 
	`off£tof
Ñy³, 
memb”
))

	)

110 
	#li¡_h—d
(
li¡
, 
ty³
, 
memb”
) \

111 
	`li¡_™em
((
li¡
)->
l_Ãxt
, 
ty³
, 
memb”
)

	)

113 
	#li¡_
(
li¡
, 
ty³
, 
memb”
) \

114 
	`li¡_™em
((
li¡
)->
l_´ev
, 
ty³
, 
memb”
)

	)

116 
	#li¡_™”©e_begš
(
li¡
, 
v¬
, 
ty³
, 
memb”
) \

118 
li¡_lšk_t
 *
__lšk
; \

119 
li¡_lšk_t
 *
__Ãxt
; \

120 
__lšk
 = (
li¡
)->
l_Ãxt
; \

121 
__lšk
 !ğ(
li¡
); \

122 
__lšk
 = 
__Ãxt
) { \

123 
v¬
 = 
	`li¡_™em
(
__lšk
, 
ty³
, 
memb”
); \

124 
__Ãxt
 = 
__lšk
->
l_Ãxt
; \

125 do

	)

127 
	#li¡_™”©e_’d
() \

130 } 0)

	)

	@nbproject/private/c_standard_headers_indexer.c

43 
	~<as£¹.h
>

44 
	~<ùy³.h
>

45 
	~<”ºo.h
>

46 
	~<æßt.h
>

47 
	~<lim™s.h
>

48 
	~<loÿË.h
>

49 
	~<m©h.h
>

50 
	~<£tjmp.h
>

51 
	~<sigÇl.h
>

52 
	~<¡d¬g.h
>

53 
	~<¡ddef.h
>

54 
	~<¡dio.h
>

55 
	~<¡ršg.h
>

56 
	~<¡dlib.h
>

57 
	~<time.h
>

58 
	~<iso646.h
>

59 
	~<wch¬.h
>

60 
	~<wùy³.h
>

61 #ifdeà
_STDC_C99


62 
	~<com¶ex.h
>

63 
	~<ãnv.h
>

64 
	~<š‰y³s.h
>

65 
	~<¡dboŞ.h
>

66 
	~<¡dšt.h
>

67 
	~<tgm©h.h
>

69 #ifdeà
_STDC_C11


70 
	~<¡d®ign.h
>

71 
	~<¡d©omic.h
>

72 
	~<¡dnÜ‘uº.h
>

73 
	~<th»ads.h
>

74 
	~<uch¬.h
>

	@ta_test.c

7 
	~<as£¹.h
>

8 
	~<¡dio.h
>

9 
	~<¡dlib.h
>

10 
	~<uni¡d.h
>

11 
	~<¡ršg.h
>

12 
	~<¡d¬g.h
>

13 
	~<sys/”ºo.h
>

15 
	~"uth»ad_sched.h
"

16 
	~"uth»ad_sched.c
"

18 
	~"uth»ad.h
"

19 
	~"uth»ad.c
"

21 
	~"uth»ad_mtx.h
"

22 
	~"uth»ad_mtx.c
"

24 
	~"uth»ad_cÚd.h
"

25 
	~"uth»ad_cÚd.c
"

27 
	~"uth»ad_queue.h
"

28 
	~"uth»ad_queue.c
"

41 
	#TEST_NUM_FORKS
 4

	)

43 
	#SBUFSZ
 256

	)

45 
	#DEBUG
(
fmt
, 
¬gs
...è
	`årštf
(
¡d”r
, "%s:%d:%s(): " fmt, 
__FILE__
, 
__LINE__
, 
__func__
, ##‡rgs)

	)

47 
	#‹¡_as£¹
(
x
) \

49 ià(!(
x
)) { \

50 
	`DEBUG
("FAILED: %s\n", #x); \

52 } 0)

	)

54 
	#‹¡_”rÜ
(
x
, 
”r
) \

55 
	`‹¡_as£¹
(-1 =ğ
x
 && 
”r
 =ğ
”ºo
)

	)

61 
th»ad_dummy_funùiÚ
(
a0
, * 
a1
);

62 
th»ad_add_‹n_to_couÁ”
(
a0
, * 
a1
);

63 
th»ad_add_‹n_to_couÁ”_w™h_š™Ÿl_wa™
(
a0
, * 
a1
);

64 
th»ad_fÜk_ü—tiÚ
(
a0
, * 
a1
);

65 
‹¡_£tup
();

66 
‹¡_»£t
();

67 
‹¡_ş—nup
();

69 
‹¡_queue
();

70 
‹¡_maš_th»ad
();

71 
‹¡_sšgË_th»ad
();

72 
‹¡_muÉË_th»ads
();

73 
‹¡_locks_ªd_cÚd™iÚs
();

74 
‹¡_´iÜ™y
();

75 
‹¡_d‘ached_th»ads
();

76 
‹¡_th»ad_bomb
();

77 
‹¡_th»ad_fÜk_ü—tiÚ
();

80 
	mTEST_QUEUE
,

81 
	mTEST_MAIN_THREAD
,

82 
	mTEST_SINGLE_THREAD
,

83 
	mTEST_MULTIPLE_THREADS
,

84 
	mTEST_LOCKS_AND_CONDS
,

85 
	mTEST_PRIORITY
,

86 
	mTEST_DETACHED_THREADS
,

87 
	mTEST_THREAD_BOMB
,

88 
	mTEST_FORK_CREATION
,

91 
	g‹¡_couÁ”
;

92 
	g‹¡_couÁ”_gu¬d
;

93 
uth»ad_mtx_t
 
	g‹¡_mtx
;

94 
uth»ad_cÚd_t
 
	g‹¡_cÚd
;

95 
	g‹¡_·u£
;

96 
uth»ad_mtx_t
 
	g‹¡_·u£_mtx
;

97 
uth»ad_cÚd_t
 
	g‹¡_·u£_cÚd
;

100 
	$maš
(
ac
, **
av
)

102 
Áe¡
;

104 ià(
ac
 < 2) {

105 
	`årštf
(
¡d”r
, "U§ge: % <‹¡_num>\n", 
av
[0]);

109 
	`uth»ad_š™
();

110 
	`‹¡_£tup
();

112 
Áe¡
 = 
	`©oi
(
av
[1]);

114 
Áe¡
) {

115 
TEST_QUEUE
:

116 
	`‹¡_queue
();

118 
TEST_MAIN_THREAD
:

119 
	`‹¡_maš_th»ad
();

121 
TEST_SINGLE_THREAD
:

122 
	`‹¡_sšgË_th»ad
();

124 
TEST_MULTIPLE_THREADS
:

125 
	`‹¡_muÉË_th»ads
();

127 
TEST_LOCKS_AND_CONDS
:

128 
	`‹¡_locks_ªd_cÚd™iÚs
();

130 
TEST_PRIORITY
:

131 
	`‹¡_´iÜ™y
();

133 
TEST_DETACHED_THREADS
:

134 
	`‹¡_maš_th»ad
();

135 
	`‹¡_d‘ached_th»ads
();

137 
TEST_THREAD_BOMB
:

138 
	`‹¡_maš_th»ad
();

139 
	`‹¡_th»ad_bomb
();

141 
TEST_FORK_CREATION
:

142 
	`‹¡_th»ad_fÜk_ü—tiÚ
();

145 
	`årštf
(
¡d”r
, "Invalidest‚umber.\n");

148 
	`‹¡_ş—nup
();

150 
	`uth»ad_ex™
(0);

151 
	`DEBUG
("Th»ad %˜gÙØth’d oàmaš, Should havex™ed THIS IS BAD\n", 
	`uth»ad_£lf
());

154 
	}
}

159 
	$‹¡_£tup
(){

160 
	`uth»ad_mtx_š™
(&
‹¡_mtx
);

161 
	`uth»ad_cÚd_š™
(&
‹¡_cÚd
);

162 
	`uth»ad_mtx_š™
(&
‹¡_·u£_mtx
);

163 
	`uth»ad_cÚd_š™
(&
‹¡_·u£_cÚd
);

164 
	`‹¡_»£t
();

165 
	}
}

170 
	$‹¡_»£t
(){

171 
‹¡_couÁ”
 = 0;

172 
‹¡_couÁ”_gu¬d
 = 0;

173 
‹¡_·u£
 = 0;

174 
	}
}

179 
	$‹¡_ş—nup
(){

181 
	}
}

187 
	$‹¡_queue
(){

188 
	`DEBUG
("Runningest_queue()\n");

189 
utqueue_t
 
queue
;

190 
uth»ad_t
 
th»ads
[10];

191 
uth»ad_t
* 
deqthr
;

192 
num_th»ads
 = 10;

193 
i
;

195 
	`utqueue_š™
(&
queue
);

198 
i
 = 0; i < 
num_th»ads
; i++){

199 
th»ads
[
i
].
ut_lšk
.
l_Ãxt
 = 
NULL
;

200 
th»ads
[
i
].
ut_lšk
.
l_´ev
 = 
NULL
;

203 
i
 = 0; i < 
num_th»ads
; i++){

204 
th»ads
[
i
].
ut_lšk
.
l_Ãxt
 = 
NULL
;

205 
th»ads
[
i
].
ut_lšk
.
l_´ev
 = 
NULL
;

206 
	`utqueue_’queue
(&
queue
, &
th»ads
[
i
]);

208 
	`‹¡_as£¹
(!
	`utqueue_em±y
(&
queue
));

210 
i
 = 0; i < 
num_th»ads
; i++){

211 
deqthr
 = 
	`utqueue_dequeue
(&
queue
);

212 
	`‹¡_as£¹
(
deqthr
 =ğ&
th»ads
[
i
]);

214 
	`‹¡_as£¹
(
	`utqueue_em±y
(&
queue
));

215 
	`DEBUG
("Passedest_queue()\n");

216 
	}
}

221 
	$‹¡_maš_th»ad
(){

222 
	`DEBUG
("Runningest_main_thread()\n");

224 
	`‹¡_as£¹
(
	`uth»ad_£lf
() == 1);

225 
	`uth»ad_£rio
(
	`uth»ad_£lf
(), 7);

226 
	`uth»ad_y›ld
();

227 
	`uth»ad_£rio
(
	`uth»ad_£lf
(), 0);

228 
	`uth»ad_y›ld
();

230 
	`‹¡_”rÜ
(
	`uth»ad_d‘ach
(-1), 
ESRCH
);

232 
	`DEBUG
("Passedest_main_thread()\n");

233 
	}
}

239 
	$‹¡_sšgË_th»ad
(){

240 
	`DEBUG
("Runningest_single_thread()\n");

241 
uth»ad_id_t
 
thr
;

242 
ex³ùed_ex™_v®ue
 = 25;

243 
ex™_v®ue
;

245 
	`‹¡_»£t
();

246 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
, 
th»ad_dummy_funùiÚ
, 
ex³ùed_ex™_v®ue
, 
NULL
, 0));

247 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
, &
ex™_v®ue
));

248 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
ex³ùed_ex™_v®ue
);

250 
	`‹¡_”rÜ
(
	`uth»ad_još
(-1,&
ex™_v®ue
), 
ESRCH
);

251 
	`‹¡_”rÜ
(
	`uth»ad_još
(
UTH_MAX_UTHREADS
+1,&
ex™_v®ue
), 
ESRCH
);

253 
	`DEBUG
("Passedest_single_thread()\n");

254 
	}
}

259 
	$‹¡_muÉË_th»ads
(){

260 
	`DEBUG
("Runningest_multiple_threads()\n");

261 
uth»ad_id_t
 
thr
[8];

262 
num_th»ads
 = 8;

263 
th»ad_numb”
, 
ex™_v®ue
;

265 
	`‹¡_»£t
();

266 
th»ad_numb”
 = 0;h»ad_numb” < 
num_th»ads
;hread_number++){

267 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
[
th»ad_numb”
], 
th»ad_dummy_funùiÚ
,h»ad_numb”, 
NULL
, 0));

269 
th»ad_numb”
 = 0;h»ad_numb” < 
num_th»ads
;hread_number++){

270 
ex™_v®ue
 = 0;

271 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
[
th»ad_numb”
], &
ex™_v®ue
));

272 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
th»ad_numb”
);

275 
	`DEBUG
("Passedest_multiple_threads()\n");

276 
	}
}

282 
	$‹¡_locks_ªd_cÚd™iÚs
(){

283 
	`DEBUG
("Runningest_locks_and_conditions()\n");

284 
uth»ad_id_t
 
thr
[8];

285 
num_thr
 = 8;

286 
th»ad_numb”
, 
ex™_v®ue
;

288 
	`‹¡_»£t
();

289 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

290 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
[
th»ad_numb”
], 
th»ad_add_‹n_to_couÁ”
,h»ad_numb”, 
NULL
, 0));

292 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

293 
ex™_v®ue
 = 0;

294 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
[
th»ad_numb”
], &
ex™_v®ue
));

295 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
th»ad_numb”
);

297 
	`‹¡_as£¹
(
‹¡_couÁ”
 =ğ10*
num_thr
);

298 
	`DEBUG
("Passedest_locks_and_conditions()\n");

299 
	}
}

304 
	$‹¡_´iÜ™y
(){

305 
	`DEBUG
("Runningest_priority()\n");

306 
uth»ad_id_t
 
thr
[8];

307 
num_thr
 = 8;

308 
th»ad_numb”
, 
ex™_v®ue
;

310 
	`‹¡_»£t
();

311 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

312 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
[
th»ad_numb”
],

313 
th»ad_add_‹n_to_couÁ”
, 
th»ad_numb”
, 
NULL
,h»ad_numb”%(
UTH_MAXPRIO
)));

315 
	`uth»ad_£rio
(
thr
[0],
UTH_MAXPRIO
);

316 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

317 
ex™_v®ue
 = 0;

318 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
[
th»ad_numb”
], &
ex™_v®ue
));

319 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
th»ad_numb”
);

321 
	`‹¡_as£¹
(
‹¡_couÁ”
 =ğ10*
num_thr
);

322 
	`DEBUG
("Passedest_priority()\n");

323 
	}
}

335 
	$‹¡_d‘ached_th»ads
(){

336 
	`DEBUG
("Runningest_detached_threads()\n");

337 
uth»ad_id_t
 
thr
[8];

338 
num_thr
 = 8;

339 
th»ad_numb”
, 
ex™_v®ue
;

341 
	`‹¡_»£t
();

342 
	`uth»ad_£rio
(
	`uth»ad_£lf
(), 0);

343 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

344 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
[
th»ad_numb”
],

345 
th»ad_add_‹n_to_couÁ”_w™h_š™Ÿl_wa™
, 
th»ad_numb”
, 
NULL
, 1));

346 
	`uth»ad_d‘ach
(
thr
[
th»ad_numb”
]);

350 
‹¡_·u£
 = 0;

351 
	`uth»ad_cÚd_brßdÿ¡
(&
‹¡_·u£_cÚd
);

353 
th»ad_numb”
 = 0;h»ad_numb” < 
num_thr
;hread_number++){

354 
	`‹¡_”rÜ
(
	`uth»ad_još
(
thr
[
th»ad_numb”
], &
ex™_v®ue
), 
EINVAL
);

357 
‹¡_couÁ”
 < 10*
num_thr
) {

358 
	`DEBUG
("Waiting for detachedhreadso finish... (spinning)\n");

359 
	`uth»ad_y›ld
();

361 
	`‹¡_as£¹
(
‹¡_couÁ”
 =ğ10*
num_thr
);

362 
	`DEBUG
("Passedest_detached_threads()\n");

363 
	}
}

381 
	$‹¡_th»ad_bomb
(){

382 
	`DEBUG
("Runningest_thread_bomb()\n");

383 
i
,
j
, 
ex™_v®ue
;

384 
num_thr
 = 
UTH_MAX_UTHREADS
;

386 
num_thr_ava
 = 
UTH_MAX_UTHREADS
-2;

387 
uth»ad_id_t
 
thr
[
UTH_MAX_UTHREADS
];

388 
	`mem£t
(
thr
,0,
UTH_MAX_UTHREADS
);

390 
	`‹¡_»£t
();

391 
‹¡_·u£
 = 1;

394 
i
 = 0; i < 
num_thr
; i++){

395 ià(
i
 < 
num_thr_ava
) {

396 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
[
i
], 
th»ad_add_‹n_to_couÁ”_w™h_š™Ÿl_wa™
, i, 
NULL
, 0));

398 
	`‹¡_”rÜ
(
	`uth»ad_ü—‹
(&
thr
[
i
], 
th»ad_add_‹n_to_couÁ”_w™h_š™Ÿl_wa™
, i, 
NULL
, 0), 
EAGAIN
);

401 ià(
i
 < 
num_thr_ava
 && i % 2 == 0) {

402 
	`uth»ad_d‘ach
(
thr
[
i
]);

407 
j
 = 0; j < 10; j++){

408 
i
 = 0; i < 
num_thr_ava
; i++){

409 
	`uth»ad_£rio
(
thr
[
i
],(i*
j
)%(
UTH_MAXPRIO
+1));

414 
‹¡_·u£
 = 0;

415 
	`uth»ad_cÚd_brßdÿ¡
(&
‹¡_·u£_cÚd
);

418 
i
 = 0; i < 
num_thr
; i++){

419 
ex™_v®ue
 = 0;

420 ià(
i
 >ğ
num_thr_ava
){

423 
»tv®
 = 
	`uth»ad_još
(
thr
[
i
], &
ex™_v®ue
);

424 ià(
”ºo
 =ğ
ESRCH
) {

425 
	`‹¡_”rÜ
(
»tv®
, 
ESRCH
);

427 
	`‹¡_”rÜ
(
»tv®
, 
EINVAL
);

431 ià(
i
 % 2 == 1){

432 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
[
i
], &
ex™_v®ue
));

433 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
i
);

438 
»tv®
 = 
	`uth»ad_još
(
thr
[
i
], &
ex™_v®ue
);

439 ià(
”ºo
 =ğ
ESRCH
) {

440 
	`‹¡_”rÜ
(
»tv®
, 
ESRCH
);

442 
	`‹¡_”rÜ
(
»tv®
, 
EINVAL
);

448 
‹¡_couÁ”
 < 10*
num_thr_ava
) {

449 
	`DEBUG
("Waiting for detachedhreadso finish... (spinning)\n");

450 
	`uth»ad_y›ld
();

453 
	`‹¡_as£¹
(
‹¡_couÁ”
 =ğ10*
num_thr_ava
);

454 
	`DEBUG
("Passedest_thread_bomb()\n");

455 
	}
}

463 
	$‹¡_th»ad_fÜk_ü—tiÚ
(){

464 
	`DEBUG
("Runningest_thread_fork_creation()\n");

465 
uth»ad_id_t
 
thr
;

466 
ex™_v®ue
, 
i
;

468 
	`‹¡_»£t
();

470 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_ü—‹
(&
thr
, 
th»ad_fÜk_ü—tiÚ
, 0, 
NULL
, 0));

472 
	`‹¡_as£¹
(0 =ğ
	`uth»ad_još
(
thr
, &
ex™_v®ue
));

473 
	`‹¡_as£¹
(
ex™_v®ue
 == 0);

475 
ex™_v®ue
 = 1;

476 
i
 = 0; i < 
TEST_NUM_FORKS
; i++)

477 
ex™_v®ue
 =ƒxit_value * 2;

479 
	`‹¡_as£¹
(
‹¡_couÁ”
 =ğ
ex™_v®ue
);

480 
	`DEBUG
("Passedest_thread_fork_creation()\n");

481 
	}
}

488 
	$th»ad_dummy_funùiÚ
(
a0
, * 
a1
){

489 (è
a1
;

490 
	`uth»ad_ex™
(
a0
);

491 
	`DEBUG
("Th»ad %˜gÙØ’d oàth»ad_dummy_funùiÚ. Should havex™ed. THIS IS BAD\n", 
	`uth»ad_£lf
());

492 
	}
}

499 
	$th»ad_add_‹n_to_couÁ”
(
a0
, * 
a1
){

500 (è
a1
;

501 
i
;

502 
i
 = 0; i < 10; i++){

503 
	`uth»ad_mtx_lock
(&
‹¡_mtx
);

504 
‹¡_couÁ”_gu¬d
)

505 
	`uth»ad_cÚd_wa™
(&
‹¡_cÚd
, &
‹¡_mtx
);

506 
‹¡_couÁ”_gu¬d
 = 1;

507 
‹¡_couÁ”
 =est_counter + 1;

508 
	`uth»ad_mtx_uÆock
(&
‹¡_mtx
);

509 
‹¡_couÁ”_gu¬d
 = 0;

510 
	`uth»ad_cÚd_sigÇl
(&
‹¡_cÚd
);

512 
	`uth»ad_ex™
(
a0
);

513 
	}
}

524 
	$th»ad_add_‹n_to_couÁ”_w™h_š™Ÿl_wa™
(
a0
, * 
a1
){

525 (è
a1
;

526 
i
;

527 
	`uth»ad_mtx_lock
(&
‹¡_·u£_mtx
);

528 
‹¡_·u£
)

529 
	`uth»ad_cÚd_wa™
(&
‹¡_·u£_cÚd
, &
‹¡_·u£_mtx
);

530 
	`uth»ad_mtx_uÆock
(&
‹¡_·u£_mtx
);

532 
i
 = 0; i < 10; i++){

533 
	`uth»ad_mtx_lock
(&
‹¡_mtx
);

534 
‹¡_couÁ”_gu¬d
)

535 
	`uth»ad_cÚd_wa™
(&
‹¡_cÚd
, &
‹¡_mtx
);

536 
‹¡_couÁ”_gu¬d
 = 1;

537 
‹¡_couÁ”
 =est_counter + 1;

538 
	`uth»ad_mtx_uÆock
(&
‹¡_mtx
);

539 
‹¡_couÁ”_gu¬d
 = 0;

540 
	`uth»ad_cÚd_sigÇl
(&
‹¡_cÚd
);

542 
	`uth»ad_ex™
(
a0
);

543 
	}
}

559 
	$th»ad_fÜk_ü—tiÚ
(
a0
, * 
a1
){

560 (è
a1
;

561 
uth»ad_id_t
 
thr1
, 
thr2
;

562 
ex™_v®ue
=-1;

563 
»tv®
=-1;

564 ià(
a0
 >ğ
TEST_NUM_FORKS
){

565 
	`uth»ad_mtx_lock
(&
‹¡_mtx
);

566 
‹¡_couÁ”
 =est_counter + 1;

567 
	`uth»ad_mtx_uÆock
(&
‹¡_mtx
);

568 
	`uth»ad_ex™
(
a0
);

572 
»tv®
 = 
	`uth»ad_ü—‹
(&
thr1
, 
th»ad_fÜk_ü—tiÚ
, 
a0
+1, 
NULL
, 0);

573 
	`‹¡_as£¹
(
»tv®
 == 0);

574 
»tv®
 = 
	`uth»ad_ü—‹
(&
thr2
, 
th»ad_fÜk_ü—tiÚ
, 
a0
+1, 
NULL
, 0);

576 
»tv®
 = 
	`uth»ad_još
(
thr1
, &
ex™_v®ue
);

577 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
a0
+1);

578 
	`‹¡_as£¹
(
»tv®
 == 0);

580 
»tv®
 = 
	`uth»ad_još
(
thr2
, &
ex™_v®ue
);

581 
	`‹¡_as£¹
(
ex™_v®ue
 =ğ
a0
+1);

582 
	`‹¡_as£¹
(
»tv®
 == 0);

584 
	`uth»ad_ex™
(
a0
);

585 
	}
}

	@tester.c

6 
	~<as£¹.h
>

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

9 
	~<uni¡d.h
>

10 
	~<¡ršg.h
>

12 
	~"uth»ad.h
"

13 
	~"uth»ad.c
"

14 
	~"uth»ad_mtx.h
"

15 
	~"uth»ad_mtx.c
"

16 
	~"uth»ad_cÚd.h
"

17 
	~"uth»ad_cÚd.c
"

18 
	~"uth»ad_sched.h
"

19 
	~"uth»ad_sched.c
"

33 
	#NUM_THREADS
 3

	)

35 
	#SBUFSZ
 256

	)

37 
uth»ad_id_t
 
	gthr
[
NUM_THREADS
];

38 
uth»ad_mtx_t
 
	gmtx
;

39 
uth»ad_cÚd_t
 
	gcÚd
;

45 
	$‹¡”
(
a0
, *
a1
)

47 
i
 = 0, 
»t
;

48 
pbufãr
[
SBUFSZ
];

50 
i
 < 10)

52 
	`¥rštf
(
pbufãr
, "th»ad %i: h–lo! (%i)\n", 
	`uth»ad_£lf
(), 
i
++);

53 
»t
 = 
	`wr™e
(
STDOUT_FILENO
, 
pbufãr
, 
	`¡¾’
(pbuffer));

54 ià(
»t
 < 0)

56 
	`³¼Ü
("uthreads_test");

58 
	`ex™
(1);

61 
	`uth»ad_mtx_lock
(&
mtx
);

62 
	`uth»ad_cÚd_sigÇl
(&
cÚd
);

63 
	`uth»ad_cÚd_wa™
(&
cÚd
, &
mtx
);

64 
	`uth»ad_mtx_uÆock
(&
mtx
);

67 
	`¥rštf
(
pbufãr
, "th»ad %˜ex™šg.\n", 
	`uth»ad_£lf
());

68 
»t
 = 
	`wr™e
(
STDOUT_FILENO
, 
pbufãr
, 
	`¡¾’
(pbuffer));

69 ià(
»t
 < 0)

71 
	`³¼Ü
("uthreads_test");

73 
	`ex™
(1);

76 
	`uth»ad_ex™
(
a0
);

77 
	}
}

80 
	$maš
(
ac
, **
av
)

82 
i
;

84 
	`uth»ad_š™
();

86 
	`uth»ad_mtx_š™
(&
mtx
);

87 
	`uth»ad_cÚd_š™
(&
cÚd
);

89 
i
 = 0; i < 
NUM_THREADS
; i++)

91 
	`uth»ad_ü—‹
(&
thr
[
i
], 
‹¡”
, i, 
NULL
, 0);

93 
	`uth»ad_£rio
(
thr
[0], 2);

96 
i
 = 0; i < 
NUM_THREADS
; i++)

98 
pbufãr
[
SBUFSZ
];

99 
tmp
, 
»t
;

101 
	`uth»ad_još
(
thr
[
i
], &
tmp
);

103 
	`¥rštf
(
pbufãr
, "jošed w™hh»ad %i,ƒx™ed %i.\n", 
thr
[
i
], 
tmp
);

104 
»t
 = 
	`wr™e
(
STDOUT_FILENO
, 
pbufãr
, 
	`¡¾’
(pbuffer));

105 ià(
»t
 < 0)

107 
	`³¼Ü
("uthreads_test");

108  
EXIT_FAILURE
;

111 
	`uth»ad_mtx_lock
(&
mtx
);

112 
	`uth»ad_cÚd_sigÇl
(&
cÚd
);

113 
	`uth»ad_mtx_uÆock
(&
mtx
);

116 
	`uth»ad_ex™
(0);

119 
	}
}

	@uthread.c

1 
	~<as£¹.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<¡ršg.h
>

5 
	~<sys/”ºo.h
>

6 
	~<sys/ty³s.h
>

7 
	~<uni¡d.h
>

9 
	~"uth»ad.h
"

10 
	~"uth»ad_´iv©e.h
"

11 
	~"uth»ad_queue.h
"

12 
	~"uth»ad_boŞ.h
"

13 
	~"uth»ad_sched.h
"

18 
uth»ad_t
 *
	gut_cu¹hr
 = 
NULL
;

19 
uth»ad_t
 
	guth»ads
[
UTH_MAX_UTHREADS
];

21 
li¡_t
 
	g»­_queue
;

22 
uth»ad_id_t
 
	g»­”_thr_id
;

27 
ü—‹_fœ¡_thr
();

29 
uth»ad_id_t
 
uth»ad_®loc
();

30 
uth»ad_de¡roy
(
uth»ad_t
 *
th»ad
);

32 *
®loc_¡ack
();

33 
ä“_¡ack
(*
¡ack
);

35 
»­”_š™
();

36 
»­”
(
a0
, *
a1
);

37 
make_»­abË
(
uth»ad_t
 *
uth
);

52 
	$uth»ad_š™
()

54 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_init");

59 
	`uth»ad_sched_š™
();

60 
	`»­”_š™
();

61 
	`ü—‹_fœ¡_thr
();

62 
	}
}

78 
	$uth»ad_ü—‹
(
uth»ad_id_t
 *
uidp
, 
uth»ad_func_t
 
func
,

79 
¬g1
, *
¬g2
, 
´io
)

81 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_create");

83 
	}
}

100 
	$uth»ad_ex™
(
¡©us
)

102 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_exit");

103 
	`uth»ad_sw™ch
();

105 
	`PANIC
("returnedo‡ deadhread");

106 
	}
}

132 
	$uth»ad_još
(
uth»ad_id_t
 
uid
, *
»tuº_v®ue
)

134 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_join");

136 
	}
}

157 
	$uth»ad_d‘ach
(
uth»ad_id_t
 
uid
)

159 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_detach");

161 
	}
}

170 
uth»ad_id_t


171 
	$uth»ad_£lf
()

173 
	`as£¹
(
ut_cu¹hr
 !ğ
NULL
);

174  
ut_cu¹hr
->
ut_id
;

175 
	}
}

190 
uth»ad_id_t


191 
__©Œibu‹__
((
unu£d
)è
	$uth»ad_®loc
()

193 
	`NOT_YET_IMPLEMENTED
("UTHREADS: __attribute__");

195 
	}
}

205 
	$uth»ad_de¡roy
(
uth»ad_t
 *
uth
)

207 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_destroy");

208 
	}
}

226 
	$»­”_š™
()

228 
	`li¡_š™
(&
»­_queue
);

229 
	`uth»ad_ü—‹
(&
»­”_thr_id
, 
»­”
, 0, 
NULL
, 
UTH_MAXPRIO
);

231 
	`as£¹
(
»­”_thr_id
 != -1);

232 
	}
}

248 
	$»­”
(
a0
, *
a1
)

252 
uth»ad_t
 *
th»ad
;

253 
th
;

256 
	`uth»ad_block
();

261 
	`li¡_™”©e_begš
(&
»­_queue
, 
th»ad
, 
uth»ad_t
, 
ut_lšk
)

263 
	`as£¹
(
th»ad
->
ut_¡©e
 =ğ
UT_ZOMBIE
);

265 
	`li¡_»move
(&
th»ad
->
ut_lšk
);

266 
	`uth»ad_de¡roy
(
th»ad
);

268 
	`li¡_™”©e_’d
();

271 
th
 = 0;h < 
UTH_MAX_UTHREADS
;h++)

273 ià(
th
 !ğ
»­”_thr_id
 &&

274 
uth»ads
[
th
].
ut_¡©e
 !ğ
UT_NO_STATE
)

280 ià(
th
 =ğ
UTH_MAX_UTHREADS
)

283 
	`årštf
(
¡d”r
, "uthreads:‚o morehreads.\n");

284 
	`årštf
(
¡d”r
, "uthreads: bye!\n");

285 
	`ex™
(0);

288 
	}
}

299 
	$ü—‹_fœ¡_thr
()

301 
uth»ad_t
 
hack
;

302 
uth»ad_id_t
 
maš_thr
;

320 
	`mem£t
(&
hack
, 0, (
uth»ad_t
));

321 
ut_cu¹hr
 = &
hack
;

322 
ut_cu¹hr
->
ut_¡©e
 = 
UT_ON_CPU
;

324 
	`uth»ad_ü—‹
(&
maš_thr
,

325 (
uth»ad_func_t
)0, 0, 
NULL
, 
UTH_MAXPRIO
);

326 
	`as£¹
(
maš_thr
 != -1);

327 
	`uth»ad_d‘ach
(
maš_thr
);

334 
	`uth»ad_g‘cÚ‹xt
(&
uth»ads
[
maš_thr
].
ut_ùx
);

336 ià(
ut_cu¹hr
 =ğ&
hack
)

338 
	`uth»ad_sw™ch
();

343 
	`as£¹
(
	`uth»ad_£lf
(è=ğ
maš_thr
);

346 
	}
}

356 
__©Œibu‹__
((
unu£d
)è
	$make_»­abË
(
uth»ad_t
 *
uth
)

358 
	`as£¹
(
uth
->
ut_d‘ached
);

359 
	`as£¹
(
uth
->
ut_¡©e
 =ğ
UT_ZOMBIE
);

360 
	`li¡_š£¹_
(&
»­_queue
, &
uth
->
ut_lšk
);

361 
	`uth»ad_wake
(&
uth»ads
[
»­”_thr_id
]);

362 
	}
}

367 
__©Œibu‹__
((
unu£d
)è*
	$®loc_¡ack
()

369  (*)
	`m®loc
(
UTH_STACK_SIZE
);

370 
	}
}

373 
__©Œibu‹__
((
unu£d
)è
	$ä“_¡ack
(*
¡ack
)

375 
	`ä“
(
¡ack
);

376 
	}
}

	@uthread.h

2 #iâdeà
__uth»ad_h__


3 
	#__uth»ad_h__


	)

5 
	~<sys/ty³s.h
>

6 
	~"uth»ad_ùx.h
"

7 
	~"uth»ad.h
"

8 
	~"li¡.h
"

13 
	#UTH_MAXPRIO
 7

	)

14 
	#UTH_MAX_UTHREADS
 64

	)

15 
	#UTH_STACK_SIZE
 64*1024

	)

17 
	#NOT_YET_IMPLEMENTED
(
msg
) \

19 
	`årštf
(
¡d”r
, "Not yet implemented‡t %s:%i -- %s\n", \

20 
__FILE__
, 
__LINE__
, (
msg
)); \

21 } 0);

	)

23 
	#PANIC
(
”r
) \

25 
	`årštf
(
¡d”r
, "PANIC‡t %s:%i -- %s\n", \

26 
__FILE__
, 
__LINE__
, 
”r
); \

27 
	`abÜt
(); \

28 } 0);

	)

30 #undeà
”ºo


31 
	#”ºo
 (
ut_cu¹hr
->
ut_”ºo
)

	)

34 
	tuth»ad_id_t
;

35 (*
	tuth»ad_func_t
)(, *);

43 
UT_NO_STATE
,

44 
UT_ON_CPU
,

45 
UT_RUNNABLE
,

46 
UT_WAIT
,

47 
UT_ZOMBIE
,

49 
UT_NUM_THREAD_STATES


50 } 
	tuth»ad_¡©e_t
;

54 
	suth»ad
 {

55 
li¡_lšk_t
 
ut_lšk
;

57 
uth»ad_ùx_t
 
ut_ùx
;

58 *
ut_¡ack
;

60 
uth»ad_id_t
 
ut_id
;

61 
uth»ad_¡©e_t
 
ut_¡©e
;

62 
ut_´io
;

63 
ut_”ºo
;

64 
ut_has_ex™ed
;

65 
ut_ex™
;

67 
ut_d‘ached
;

68 
uth»ad
 *
ut_wa™”
;

69 } 
	tuth»ad_t
;

77 
uth»ad_t
 
uth»ads
[
UTH_MAX_UTHREADS
];

78 
uth»ad_t
 *
ut_cu¹hr
;

80 
	`uth»ad_š™
();

82 
	`uth»ad_ü—‹
(
uth»ad_id_t
 *
id
, 
uth»ad_func_t
 
func
, 
¬g1
,

83 *
¬g2
, 
´io
);

84 
	`uth»ad_ex™
(
¡©us
);

85 
uth»ad_id_t
 
	`uth»ad_£lf
();

87 
	`uth»ad_još
(
uth»ad_id_t
 
id
, *
ex™_v®ue
);

88 
	`uth»ad_d‘ach
(
uth»ad_id_t
 
id
);

	@uthread_bool.h

1 #iâdeà
_uth»ad_boŞ_h_


2 
	#_uth»ad_boŞ_h_


	)

7 
	tboŞ
;

9 #iâdeà
Œue


10 
	#Œue
 1

	)

13 #iâdeà
çl£


14 
	#çl£
 0

	)

	@uthread_cond.c

1 
	~<as£¹.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

5 
	~"uth»ad.h
"

6 
	~"uth»ad_mtx.h
"

7 
	~"uth»ad_cÚd.h
"

8 
	~"uth»ad_queue.h
"

9 
	~"uth»ad_sched.h
"

18 
	$uth»ad_cÚd_š™
(
uth»ad_cÚd_t
 *
cÚd
)

20 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_cond_init");

21 
	}
}

32 
	$uth»ad_cÚd_wa™
(
uth»ad_cÚd_t
 *
cÚd
, 
uth»ad_mtx_t
 *
mtx
)

34 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_cond_wait");

35 
	}
}

45 
	$uth»ad_cÚd_brßdÿ¡
(
uth»ad_cÚd_t
 *
cÚd
)

47 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_cond_broadcast");

48 
	}
}

59 
	$uth»ad_cÚd_sigÇl
(
uth»ad_cÚd_t
 *
cÚd
)

61 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_cond_signal");

62 
	}
}

	@uthread_cond.h

2 #iâdeà
__uth»ad_cÚd_h__


3 
	#__uth»ad_cÚd_h__


	)

6 
	guth»ad_mtx
;

7 
	gutqueue
;

9 
	suth»ad_cÚd
 {

10 
utqueue
 
	muc_wa™”s
;

11 } 
	tuth»ad_cÚd_t
;

14 
uth»ad_cÚd_š™
(
uth»ad_cÚd_t
 *);

15 
uth»ad_cÚd_wa™
(
uth»ad_cÚd_t
 *, 
uth»ad_mtx
 *);

16 
uth»ad_cÚd_sigÇl
(
uth»ad_cÚd_t
 *);

17 
uth»ad_cÚd_brßdÿ¡
(
uth»ad_cÚd_t
 *);

	@uthread_ctx.c

2 
	~<as£¹.h
>

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

6 
	~"uth»ad.h
"

7 
	~"uth»ad_ùx.h
"

10 
th»ad_¡¬t
((*
func
)(), 
¬g1
, *
¬g2
);

16 
	$uth»ad_makecÚ‹xt
(
uth»ad_ùx_t
 *
ùx
, *
¡ack
, 
¡acksz
,

17 (*
func
)(), 
¬g1
, *
¬g2
)

19 
rv
;

21 
	`as£¹
(
ùx
 !ğ
NULL
);

22 
	`as£¹
(
¡ack
 !ğ
NULL
 && 
¡acksz
 > 0);

25 
rv
 = 
	`g‘cÚ‹xt
(
ùx
);

26 
	`as£¹
(
rv
 != -1);

30 
ùx
->
uc_¡ack
.
ss_¥
 = (*)
¡ack
;

34 
ùx
->
uc_¡ack
.
ss_size
 = 
¡acksz
;

35 
ùx
->
uc_¡ack
.
ss_æags
 = 0;

36 
ùx
->
uc_lšk
 = 
NULL
;

39 
	`makecÚ‹xt
(
ùx
, ((*)())
th»ad_¡¬t
, 3, 
func
, 
¬g1
, 
¬g2
);

41 
	}
}

45 
	$uth»ad_£tcÚ‹xt
(
uth»ad_ùx_t
 *
ùx
)

47 
	`as£¹
(
ùx
 !ğ
NULL
);

48 
	`£tcÚ‹xt
(
ùx
);

49 
	}
}

52 
	$uth»ad_sw­cÚ‹xt
(
uth»ad_ùx_t
 *
Şdùx
, uth»ad_ùx_ˆ*
Ãwùx
)

54 
	`as£¹
(
Şdùx
 !ğ
NULL
 && 
Ãwùx
 != NULL);

55 
	`sw­cÚ‹xt
(
Şdùx
, 
Ãwùx
);

56 
	}
}

63 
	$th»ad_¡¬t
((*
func
)(), 
¬g1
, *
¬g2
)

65 
	`as£¹
(
func
 !ğ
NULL
);

66 (
func
)(
¬g1
, 
¬g2
);

69 
	`uth»ad_ex™
(0);

70 
	}
}

	@uthread_ctx.h

2 #iâdeà
__uth»ad_lšux_ùx_h__


3 
	#__uth»ad_lšux_ùx_h__


	)

5 #ifdeà
_REENTRANT


6 #”rÜ 
Compšg
 -
mt
 
is
 
NOT
 
suµÜ‹d


9 
	~<ucÚ‹xt.h
>

11 
ucÚ‹xt_t
 
	tuth»ad_ùx_t
;

19 
uth»ad_makecÚ‹xt
(
uth»ad_ùx_t
 *
ùx
, *
¡ack
, 
¡acksz
,

20 (*
func
)(), 
¬g1
, *
¬g2
);

24 
uth»ad_£tcÚ‹xt
(
uth»ad_ùx_t
 *
ùx
);

29 
	#uth»ad_g‘cÚ‹xt
(
ùx
) \

31 
	`as£¹
(
ùx
); \

32 
	`g‘cÚ‹xt
(
ùx
); \

33 } 0);

	)

40 
uth»ad_sw­cÚ‹xt
(
uth»ad_ùx_t
 *
Şdùx
, uth»ad_ùx_ˆ*
Ãwùx
);

	@uthread_idle.c

2 
	~<sched.h
>

4 
	~"uth»ad.h
"

5 
	~"uth»ad_´iv©e.h
"

16 
	$uth»ad_idË
()

19 
	`sched_y›ld
();

24 
	}
}

	@uthread_mtx.c

2 
	~<as£¹.h
>

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

6 
	~"li¡.h
"

7 
	~"uth»ad.h
"

8 
	~"uth»ad_mtx.h
"

9 
	~"uth»ad_sched.h
"

19 
	$uth»ad_mtx_š™
(
uth»ad_mtx_t
 *
mtx
)

21 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_mtx_init");

22 
	}
}

33 
	$uth»ad_mtx_lock
(
uth»ad_mtx_t
 *
mtx
)

35 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_mtx_lock");

36 
	}
}

46 
	$uth»ad_mtx_Œylock
(
uth»ad_mtx_t
 *
mtx
)

48 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_mtx_trylock");

50 
	}
}

61 
	$uth»ad_mtx_uÆock
(
uth»ad_mtx_t
 *
mtx
)

63 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_mtx_unlock");

64 
	}
}

	@uthread_mtx.h

2 #iâdeà
__uth»ad_mtx_h__


3 
	#__uth»ad_mtx_h__


	)

6 
	~"uth»ad_queue.h
"

9 
	guth»ad
;

11 
	suth»ad_mtx
 {

12 
uth»ad
 *
	mm_owÃr
;

13 
utqueue_t
 
	mm_wa™”s
;

14 } 
	tuth»ad_mtx_t
;

16 
uth»ad_mtx_š™
(
uth»ad_mtx_t
 *
mtx
);

17 
uth»ad_mtx_lock
(
uth»ad_mtx_t
 *
mtx
);

18 
uth»ad_mtx_uÆock
(
uth»ad_mtx_t
 *
mtx
);

19 
uth»ad_mtx_Œylock
(
uth»ad_mtx_t
 *
mtx
);

	@uthread_private.h

2 #iâdeà
__uth»ad_´iv©e_h__


3 
	#__uth»ad_´iv©e_h__


	)

10 
uth»ad_sched_š™
();

18 
uth»ad_sw™ch
();

25 
uth»ad_idË
();

	@uthread_queue.c

2 
	~<as£¹.h
>

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

6 
	~"uth»ad.h
"

7 
	~"uth»ad_queue.h
"

15 
	$utqueue_š™
(
utqueue_t
 *
q
)

17 
	`as£¹
(
q
 !ğ
NULL
);

19 
	`li¡_š™
(&
q
->
tq_wa™”s
);

20 
q
->
tq_size
 = 0;

21 
	}
}

31 
	$utqueue_em±y
(
utqueue_t
 *
q
)

33 
	`as£¹
(
q
 !ğ
NULL
);

34 
	`as£¹
(
	`li¡_em±y
(&
q
->
tq_wa™”s
è=ğ(q->
tq_size
 == 0));

36  (
q
->
tq_size
 == 0);

37 
	}
}

46 
	$utqueue_’queue
(
utqueue_t
 *
q
, 
uth»ad_t
 *
thr
)

48 
	`as£¹
(
thr
->
ut_lšk
.
l_Ãxt
 =ğ
NULL
 &&hr->ut_lšk.
l_´ev
 == NULL);

50 
	`li¡_š£¹_h—d
(&
q
->
tq_wa™”s
, &
thr
->
ut_lšk
);

51 
q
->
tq_size
++;

52 
	}
}

60 
uth»ad_t
 *

61 
	$utqueue_dequeue
(
utqueue_t
 *
q
)

63 
uth»ad_t
 *
thr
;

64 
li¡_lšk_t
 *
lšk
;

66 
	`as£¹
(
q
 !ğ
NULL
);

68 ià(
	`utqueue_em±y
(
q
))

70  
NULL
;

73 
lšk
 = 
q
->
tq_wa™”s
.
l_´ev
;

74 
thr
 = 
	`li¡_™em
(
lšk
, 
uth»ad_t
, 
ut_lšk
);

75 
	`li¡_»move
(
lšk
);

77 
q
->
tq_size
--;

79  
thr
;

80 
	}
}

89 
	$utqueue_»move
(
utqueue_t
 *
q
, 
uth»ad_t
 *
thr
)

91 
	`as£¹
(
thr
->
ut_lšk
.
l_Ãxt
 !ğ
NULL
 &&hr->ut_lšk.
l_´ev
 != NULL);

93 
	`li¡_»move
(&
thr
->
ut_lšk
);

94 
q
->
tq_size
--;

95 
	}
}

	@uthread_queue.h

2 #iâdeà
__uth»ad_queue_h__


3 
	#__uth»ad_queue_h__


	)

5 
	~"li¡.h
"

8 
	guth»ad
;

10 
	sutqueue
 {

11 
li¡_t
 
	mtq_wa™”s
;

12 
	mtq_size
;

13 } 
	tutqueue_t
;

18 
utqueue_š™
(
utqueue_t
 *
q
);

19 
utqueue_em±y
(
utqueue_t
 *
q
);

20 
utqueue_’queue
(
utqueue_t
 *
q
, 
uth»ad
 *
thr
);

21 
utqueue_»move
(
utqueue_t
 *
q
, 
uth»ad
 *
thr
);

22 
uth»ad
 *
utqueue_dequeue
(
utqueue_t
 *
q
);

	@uthread_sched.c

2 
	~<as£¹.h
>

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<sys/”ºo.h
>

7 
	~"uth»ad.h
"

8 
	~"uth»ad_´iv©e.h
"

9 
	~"uth»ad_ùx.h
"

10 
	~"uth»ad_queue.h
"

11 
	~"uth»ad_boŞ.h
"

12 
	~"uth»ad_sched.h
"

19 
utqueue_t
 
__©Œibu‹__
((
unu£d
)è
	grunq_bË
[
UTH_MAXPRIO
 + 1];

37 
	$uth»ad_y›ld
()

39 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_yield");

40 
	}
}

51 
	$uth»ad_block
()

53 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_block");

54 
	}
}

66 
	$uth»ad_wake
(
uth»ad_t
 *
uthr
)

68 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_wake");

69 
	}
}

81 
	$uth»ad_£rio
(
uth»ad_id_t
 
id
, 
´io
)

83 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_setprio");

85 
	}
}

109 
	$uth»ad_sw™ch
()

111 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_switch");

112 
	}
}

122 
	$uth»ad_sched_š™
()

124 
	`NOT_YET_IMPLEMENTED
("UTHREADS: uthread_sched_init");

125 
	}
}

	@uthread_sched.h

2 #iâdeà
__uth»ad_sched_h__


3 
	#__uth»ad_sched_h__


	)

5 
	~<sys/ty³s.h
>

6 
	~"uth»ad.h
"

8 
uth»ad_£rio
(
uth»ad_id_t
 
id
, 
´io
);

9 
uth»ad_y›ld
();

10 
uth»ad_block
();

11 
uth»ad_wake
(
uth»ad_t
 *
uthr
);

	@
1
.
0
20
303
interpose.c
list.h
nbproject/private/c_standard_headers_indexer.c
ta_test.c
tester.c
uthread.c
uthread.h
uthread_bool.h
uthread_cond.c
uthread_cond.h
uthread_ctx.c
uthread_ctx.h
uthread_idle.c
uthread_mtx.c
uthread_mtx.h
uthread_private.h
uthread_queue.c
uthread_queue.h
uthread_sched.c
uthread_sched.h
